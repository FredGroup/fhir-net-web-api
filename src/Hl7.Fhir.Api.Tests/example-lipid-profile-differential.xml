<?xml version="1.0" encoding="utf-8"?>
<Profile xmlns="http://hl7.org/fhir">
  <identifier value="urn:hl7.org:lipid-profile:v1" />
  <version value="1.0.0" />
  <name value="Lipid Profile" />
  <publisher value="HL7 International" />
  <telecom>
    <system value="email" />
    <value value="e.kramer@furore.com" />
  </telecom>
  <description value="Describes how the lab report is used for a standard Lipid Profile - Cholesterol, Triglyceride and Cholesterol fractions. Uses LOINC codes&#xD;&#xA;" />
  <code>
    <system value="http://loinc.org/" />
    <code value="58239-5" />
    <display value="lipid profile" />
  </code>
  <status value="draft" />
  <experimental value="true" />
  <date value="2014-04-17T00:00:00+02:00" />
  <requirements value="Covers example areas of Profile authoring and was created to serve as an example in the specification and during this tutorial" />
  <fhirVersion value="0.80" />
  <structure>
    <type value="DiagnosticReport" />
    <name value="lipidPanel" />
    <publish value="true" />
    <element>
      <path value="DiagnosticReport" />
      <definition>
        <short value="Lipid Lab Report" />
        <formal value="The findings and interpretation of a general lipd lab profile" />
        <comments value="Note that this profile doesn't mention workflow  elements - it's solely concerned with the semantics of a lipid report. Things that are ignored are not constrained" />
      </definition>
    </element>
    <element>
      <path value="DiagnosticReport.result" />
      <slicing>
        <discriminator value="name" />
        <ordered value="true" />
        <rules value="closed" />
      </slicing>
      <definition>
        <short value="Observations - simple, or complex nested groups" />
        <formal value="Observations that are part of this diagnostic report. Observations can be simple name/value pairs (e.g. &quot;atomic&quot; results), or they can be grouping observations that include references to other members of the group (e.g. &quot;panels&quot;)." />
        <comments value="Cardinality 3..4, since chol, trig, hdlc are mandatory, ldlc is optional" />
        <min value="3" />
        <max value="4" /> 
      </definition>
    </element>
    <element>
      <path value="DiagnosticReport.result" />
      <name value="cholesterol" />
      <definition>
        <short value="Cholesterol observation" />
        <formal value="Observations that are part of this diagnostic report. Observations can be simple name/value pairs (e.g. &quot;atomic&quot; results), or they can be grouping observations that include references to other members of the group (e.g. &quot;panels&quot;)." />
        <min value="1" />
        <max value="1" />
        <type>
          <code value="ResourceReference" />
          <profile value="#cholesterol" />
          <aggregation value="bundled" />
        </type>
      </definition>
    </element>
    <element>
      <path value="DiagnosticReport.result" />
      <name value="triglyceride" />
      <definition>
        <short value="Triglyceride observation" />
        <formal value="Observations that are part of this diagnostic report. Observations can be simple name/value pairs (e.g. &quot;atomic&quot; results), or they can be grouping observations that include references to other members of the group (e.g. &quot;panels&quot;)." />
        <min value="1" />
        <max value="1" />
        <type>
          <code value="ResourceReference" />
          <profile value="#triglyceride" />
          <aggregation value="bundled" />
        </type>
      </definition>
    </element>
  </structure> 
  <structure>
    <type value="Observation" />
    <name value="cholesterol" />
    <publish value="true" />
    <element>
      <path value="Observation" />
      <definition>
        <short value="Cholesterol measurement" />
        <formal value="Cholesterol measurement" />
        <constraint>
          <key value="chol-01" />
          <name value="Must have valueQuantity or comment" />
          <severity value="error" />
          <human value="If a Cholesterol value result is not available, use the comments field" />
          <xpath value="exists(f:valueQuantity) or exists(f:comment)" />
        </constraint>
      </definition>
    </element>
    <element>
      <path value="Observation.name.coding.system" />
      <definition>
        <min value="1" />
        <max value="1" />
        <valueUri value="http://loinc.org/" />
      </definition>
    </element>
    <element>
      <path value="Observation.name.coding.version" />
      <definition>
        <min value="0" />
        <max value="0" />
      </definition>
    </element>
    <element>
      <path value="Observation.name.coding.code" />
      <definition>
        <min value="1" />
        <max value="1" />
        <valueCode value="35200-5" />
      </definition>
    </element>
    <element>
      <path value="Observation.name.coding.display" />
      <definition>
        <valueString value="Cholesterol" />
      </definition>
    </element>
    <element>
      <path value="Observation.name.coding.primary" />
      <definition>
        <min value="0" />
        <max value="0" />
      </definition>
    </element>
  </structure>
  <structure>
    <type value="MessageHeader" />
    <name value="newLipidResult" />
    <publish value="true" />
    <element>
      <path value="MessageHeader.data" />
      <definition>
        <short value="The actual content of the message" />
        <formal value="The actual data of the message - a reference to the root/focus class of the event." />
        <comments value="The data is defined where the transaction type is defined. The transaction data is always included in the bundle that is the full message.  Only the root resource is specified.  The resources it references should be contained in the bundle but are not also listed here.  Multiple repetitions are allowed to cater for merges and other situations with multiple focal targets." />
        <min value="1" />
        <max value="1" />
        <type>
          <code value="ResourceReference" />
          <profile value="#lipidPanel" />
          <aggregation value="bundled" />
        </type>
        <isModifier value="false" />
        <mapping>
          <identity value="rim" />
          <map value="unique(./controlAct[classCode=&quot;CACT&quot; and classCode=&quot;EVN&quot; and isNormalAct()]/participation[typeCode=&quot;SUBJ&quot; and isNormalParticipation]/role or ./controlAct[classCode=&quot;CACT&quot; and classCode=&quot;EVN&quot; and isNormalAct()]/outboundRelationship[typeCode=&quot;SBJ&quot; and isNormalActRelatoinship]/target)" />
        </mapping>
      </definition>
    </element>
    <searchParam>
      <name value="_id" />
      <type value="token" />
      <documentation value="The logical resource id associated with the resource (must be supported by all servers)" />
    </searchParam>
  </structure>
  <extensionDefn>
    <code value="calculated" />
    <contextType value="resource" />
    <context value="Observation.valueQuantity" />
    <definition>
      <short value="LDL is Calculated" />
      <formal value="True if the value is calculated from other observations" />
      <comments value="E.g. True if the LDL value is calculated from Chol, Trig, and HDLC" />
      <type>
        <code value="boolean" />
      </type>
    </definition>
  </extensionDefn>
</Profile>